<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/graficopie.css">
    <title>Gr√°fico Pizza</title>
</head>

<body>

    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <script>
        let series; // Declarar fora para acesso no listener depois

        am5.ready(function () {
            var root = am5.Root.new("chartdiv");

            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            var chart = root.container.children.push(
                am5percent.PieChart.new(root, {
                    layout: root.verticalLayout
                })
            );

            series = chart.series.push(
                am5percent.PieSeries.new(root, {
                    valueField: "value",
                    categoryField: "category"
                })
            );

            // Dados iniciais (opcional)
            series.data.setAll([
                { value: 10, category: "Aguardando dados..." }
            ]);

            series.appear(1000, 100);
        });

        window.addEventListener("message", function (event) {
            if (event.data.tipo === "dadosRelatorio") {
                const dados = event.data.dados;

                // Corrigido: nome correto do campo
                const pieData = dados.idade_media_departamento.map(dep => ({
                    category: dep.departamento,
                    value: parseFloat(dep.idade_media)
                }));

                if (series) {
                    series.data.setAll(pieData);
                }
            }
        });


    </script>

    <div id="chartdiv" style="width: 100%; height: 500px;"></div>

</body>

</html>